# 2025-01-13 ì‘ì—… ì¼ì§€

## ì‘ì—… ê°œìš”
Managing Agent ì•±ì˜ Phase 1 MVP ì™„ì„±
- ì‘ì—… ëª©ë¡ í‘œì‹œ ë²„ê·¸ ìˆ˜ì •
- í¬ì»¤ìŠ¤ íƒ€ì´ë¨¸ ê¸°ëŠ¥ ì „ì²´ êµ¬í˜„

---

## 1. ì‘ì—… ëª©ë¡ í‘œì‹œ ë²„ê·¸ ìˆ˜ì •

### ë¬¸ì œ ìƒí™©
- ì‚¬ìš©ìê°€ ì‘ì—…(Task)ì„ ì¶”ê°€í–ˆì§€ë§Œ "ì˜¤ëŠ˜ í•  ì¼" ëª©ë¡ì— í‘œì‹œë˜ì§€ ì•ŠëŠ” ë¬¸ì œ
- ë°ì´í„°ë² ì´ìŠ¤ì—ëŠ” ì •ìƒì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìœ¼ë‚˜ API ì¿¼ë¦¬ì—ì„œ ì¡°íšŒë˜ì§€ ì•ŠìŒ

### ì›ì¸ ë¶„ì„
- `/app/api/tasks/today/route.ts`ì—ì„œ ë‚ ì§œ ë¹„êµ ë¡œì§ ë¬¸ì œ
- íƒ€ì„ì¡´ ë³€í™˜ ì°¨ì´ë¡œ ì¸í•´ `scheduledDate: '2025-11-12'` (YYYY-MM-DD ë¬¸ìì—´)ê°€ UTC íƒ€ì„ìŠ¤íƒ¬í”„ë¡œ ë³€í™˜ë  ë•Œ ë¡œì»¬ midnightê³¼ ë¹„êµ ì‹¤íŒ¨
- ê¸°ì¡´ ì½”ë“œ: ì—„ê²©í•œ ë‹¹ì¼ ë²”ìœ„ (today 00:00 ~ tomorrow 00:00)

### í•´ê²° ë°©ë²•
```typescript
// Before (BUGGY)
const today = new Date();
today.setHours(0, 0, 0, 0);
const tomorrow = new Date(today);
tomorrow.setDate(tomorrow.getDate() + 1);
where.scheduledDate = { gte: today, lt: tomorrow };

// After (FIXED)
const yesterday = new Date(now);
yesterday.setDate(yesterday.getDate() - 1);
yesterday.setHours(0, 0, 0, 0);

const dayAfterTomorrow = new Date(now);
dayAfterTomorrow.setDate(dayAfterTomorrow.getDate() + 2);
dayAfterTomorrow.setHours(23, 59, 59, 999);

where.OR = [
  { scheduledDate: { gte: yesterday, lte: dayAfterTomorrow } },
  { scheduledDate: null, status: 'todo' },
  { scheduledDate: null, status: 'in_progress' }
];
```

### ê²€ì¦
- `scripts/check-tasks.js` - ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§ì ‘ ì‘ì—… ì¡°íšŒ (6ê°œ í™•ì¸)
- `scripts/test-api.js` - API ì¿¼ë¦¬ ë¡œì§ í…ŒìŠ¤íŠ¸ (6ê°œ ë°˜í™˜ í™•ì¸)
- ì„œë²„ ë¡œê·¸ì—ì„œ `Today tasks fetched: 0` â†’ `Today tasks fetched: 6`ìœ¼ë¡œ ë³€ê²½ í™•ì¸

### ê²°ê³¼
âœ… ì‘ì—… ìƒì„± í›„ ëª©ë¡ì— ì •ìƒ í‘œì‹œë¨

---

## 2. í¬ì»¤ìŠ¤ íƒ€ì´ë¨¸ êµ¬í˜„

### 2.1 FocusTimer ì»´í¬ë„ŒíŠ¸ (`components/dashboard/FocusTimer.tsx`)

#### ì£¼ìš” ê¸°ëŠ¥
- **í”„ë¦¬ì…‹ ë²„íŠ¼**: 25ë¶„, 50ë¶„, 90ë¶„
- **ì»¤ìŠ¤í…€ ì…ë ¥**: 1-999ë¶„ ì§ì ‘ ì…ë ¥
- **íƒ€ì´ë¨¸ ìƒíƒœ**: idle, running, paused
- **ì‘ì—… ì—°ê²°**: ë“œë¡­ë‹¤ìš´ì—ì„œ ì˜¤ëŠ˜ í•  ì¼ ì„ íƒ ê°€ëŠ¥
- **ì§„í–‰ë¥  í‘œì‹œ**: í”„ë¡œê·¸ë ˆìŠ¤ë°”ì™€ ê²½ê³¼ ì‹œê°„
- **ë¸Œë¼ìš°ì € ì•Œë¦¼**: ê¶Œí•œ ìš”ì²­ ë° ì™„ë£Œ ì‹œ ì•Œë¦¼

#### íƒ€ì´ë¨¸ ë¡œì§
```typescript
// ìƒíƒœ ê´€ë¦¬
const [timerState, setTimerState] = useState<TimerState>('idle');
const [timeLeft, setTimeLeft] = useState(25 * 60); // seconds
const [sessionId, setSessionId] = useState<string | null>(null);

// ì‹œì‘: FocusSession ìƒì„±
handleStart() -> POST /api/focus-sessions

// ì¼ì‹œì •ì§€/ì¬ê°œ: ë¡œì»¬ ìƒíƒœë§Œ ë³€ê²½
handlePause() -> timerState í† ê¸€

// ì¤‘ë‹¨: interrupted=trueë¡œ ê¸°ë¡
handleStop() -> PATCH /api/focus-sessions/[id]
  { actualTime, completed: false, interrupted: true }

// ì™„ë£Œ: completed=trueë¡œ ê¸°ë¡ + ì•Œë¦¼
handleComplete() -> PATCH /api/focus-sessions/[id]
  { actualTime, completed: true, interrupted: false }
  + new Notification()
```

#### ê²½ê³¼ ì‹œê°„ ì¶”ì 
```typescript
const intervalRef = useRef<NodeJS.Timeout | null>(null);
const startTimeRef = useRef<number>(0);
const elapsedRef = useRef<number>(0);

// running ìƒíƒœì¼ ë•Œ 1ì´ˆë§ˆë‹¤ timeLeft ê°ì†Œ
useEffect(() => {
  if (timerState === 'running') {
    intervalRef.current = setInterval(() => {
      setTimeLeft((prev) => prev > 0 ? prev - 1 : 0);
    }, 1000);
  }
  return () => clearInterval(intervalRef.current);
}, [timerState]);

// timeLeftê°€ 0ì´ ë˜ë©´ ìë™ ì™„ë£Œ
useEffect(() => {
  if (timeLeft === 0 && timerState === 'running') {
    handleComplete();
  }
}, [timeLeft, timerState]);
```

### 2.2 FocusSession API

#### `POST /api/focus-sessions`
- ìƒˆ í¬ì»¤ìŠ¤ ì„¸ì…˜ ìƒì„±
- taskId ìœ íš¨ì„± ê²€ì¦ (ì œê³µëœ ê²½ìš°)
- ì´ˆê¸°ê°’: `actualTime: 0, completed: false, interrupted: false`

#### `PATCH /api/focus-sessions/[id]`
- ì„¸ì…˜ ì—…ë°ì´íŠ¸ (ì™„ë£Œ/ì¤‘ë‹¨)
- ì†Œìœ ê¶Œ í™•ì¸ (userId ì¼ì¹˜ ì—¬ë¶€)
- actualTime(ë¶„), completed, interrupted í•„ë“œ ì—…ë°ì´íŠ¸

#### `GET /api/focus-sessions`
- ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ (ê¸°ë³¸ 50ê°œ)
- ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°: `taskId`, `limit`
- í†µê³„ ê³„ì‚°:
  ```typescript
  stats: {
    total: sessions.length,
    completed: sessions.filter(s => s.completed).length,
    interrupted: sessions.filter(s => s.interrupted).length,
    totalMinutes: sessions.reduce((sum, s) => sum + s.actualTime, 0)
  }
  ```

#### `DELETE /api/focus-sessions/[id]`
- ì„¸ì…˜ ì‚­ì œ (í–¥í›„ íˆìŠ¤í† ë¦¬ ì •ë¦¬ìš©)

### 2.3 FocusHistory ì»´í¬ë„ŒíŠ¸ (`components/dashboard/FocusHistory.tsx`)

#### í‘œì‹œ ë‚´ìš©
- **ìƒë‹¨ í†µê³„**:
  - ì´ ì„¸ì…˜ ìˆ˜
  - ì™„ë£Œ ì„¸ì…˜ (ì´ˆë¡ìƒ‰)
  - ì¤‘ë‹¨ ì„¸ì…˜ (ë…¸ë€ìƒ‰)
  - ì´ ì‹œê°„ (formatDuration)

- **ì„¸ì…˜ ë¦¬ìŠ¤íŠ¸** (ìµœê·¼ 10ê°œ):
  - ì—°ê²°ëœ ì‘ì—… ì œëª© (ë˜ëŠ” "ì¼ë°˜ í¬ì»¤ìŠ¤")
  - ìƒëŒ€ ì‹œê°„ (formatRelativeTime: "5ë¶„ ì „", "1ì‹œê°„ ì „")
  - ì‹¤ì œ ì‹œê°„ / ê³„íš ì‹œê°„ (ì˜ˆ: "23ë¶„ / 25ë¶„")
  - ìƒíƒœ ë±ƒì§€ (ì™„ë£Œ/ì¤‘ë‹¨/ì§„í–‰ì¤‘)

#### ìë™ ê°±ì‹ 
```typescript
// ë¶€ëª¨ì—ì„œ ì „ë‹¬ë°›ì€ refreshKeyê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ì¬ì¡°íšŒ
useEffect(() => {
  fetchSessions();
}, [refreshKey]);
```

### 2.4 ëŒ€ì‹œë³´ë“œ í†µí•© (`app/dashboard/page.tsx`)

#### ë ˆì´ì•„ì›ƒ êµ¬ì¡°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Header                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Goal     â”‚  Task List              â”‚
â”‚  Panel    â”‚                         â”‚
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           â”‚  Focus Timer            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚
â”‚  Focus    â”‚                         â”‚
â”‚  History  â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ìƒíƒœ ê´€ë¦¬
```typescript
const [todayTasks, setTodayTasks] = useState<Task[]>([]);
const [focusHistoryKey, setFocusHistoryKey] = useState(0);

// ë¯¸ì™„ë£Œ ì‘ì—…ë§Œ íƒ€ì´ë¨¸ì— ì „ë‹¬
useEffect(() => {
  if (isAuthenticated) {
    fetchTodayTasks();
  }
}, [isAuthenticated, taskKey]);

const fetchTodayTasks = async () => {
  const response = await fetch('/api/tasks/today?includeUnscheduled=true');
  const data = await response.json();
  if (data.success) {
    const incompleteTasks = data.tasks.filter(
      (task: Task) => task.status !== 'completed'
    );
    setTodayTasks(incompleteTasks);
  }
};
```

#### ì„¸ì…˜ ì™„ë£Œ ì‹œ íˆìŠ¤í† ë¦¬ ê°±ì‹ 
```typescript
<FocusTimer
  tasks={todayTasks}
  onSessionComplete={() => setFocusHistoryKey((prev) => prev + 1)}
/>
```

---

## 3. ìƒˆë¡œ ì¶”ê°€ëœ íŒŒì¼

### ì»´í¬ë„ŒíŠ¸
- `components/dashboard/FocusTimer.tsx` (355ì¤„)
- `components/dashboard/FocusHistory.tsx` (154ì¤„)

### API ë¼ìš°íŠ¸
- `app/api/focus-sessions/route.ts` (POST, GET)
- `app/api/focus-sessions/[id]/route.ts` (PATCH, DELETE)

### ìœ í‹¸ë¦¬í‹° ìŠ¤í¬ë¦½íŠ¸ (ë””ë²„ê¹…ìš©, ì‚­ì œë¨)
- `scripts/check-tasks.js` - ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—… í™•ì¸
- `scripts/test-api.js` - API ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸

---

## 4. ìˆ˜ì •ëœ íŒŒì¼

### `app/api/tasks/today/route.ts`
- ë‚ ì§œ ë²”ìœ„ ë¡œì§ ìˆ˜ì • (ì–´ì œ~ëª¨ë ˆ)
- ë””ë²„ê·¸ ë¡œê·¸ ì¶”ê°€ (`Date range:`, `Today tasks fetched:`)

### `app/dashboard/page.tsx`
- FocusTimer, FocusHistory import
- todayTasks, focusHistoryKey ìƒíƒœ ì¶”ê°€
- fetchTodayTasks í•¨ìˆ˜ ì¶”ê°€
- ë ˆì´ì•„ì›ƒ êµ¬ì¡° ë³€ê²½ (Goal + History ê°™ì€ ì—´)

### `components/dashboard/TaskList.tsx`
- ë””ë²„ê·¸ ë¡œê·¸ ì¶”ê°€ (ì´ë¯¸ ì´ì „ì— ì¶”ê°€ë¨)

### `components/dashboard/TaskModal.tsx`
- ë””ë²„ê·¸ ë¡œê·¸ ì¶”ê°€ (ì´ë¯¸ ì´ì „ì— ì¶”ê°€ë¨)

---

## 5. ë¸Œë¼ìš°ì € ì•Œë¦¼ êµ¬í˜„

### ê¶Œí•œ ìš”ì²­
```typescript
const requestNotificationPermission = async () => {
  if ('Notification' in window && Notification.permission === 'default') {
    const permission = await Notification.requestPermission();
    if (permission === 'granted') {
      console.log('Notification permission granted');
    }
  }
};
```

### ì•Œë¦¼ ì „ì†¡
```typescript
if ('Notification' in window && Notification.permission === 'granted') {
  new Notification('í¬ì»¤ìŠ¤ ì„¸ì…˜ ì™„ë£Œ!', {
    body: `${selectedMinutes}ë¶„ ì§‘ì¤‘ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤. ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!`,
    icon: '/favicon.ico',
  });
}
```

### UI
- "ì•Œë¦¼ í—ˆìš©" ë²„íŠ¼ (permission === 'default'ì¼ ë•Œë§Œ í‘œì‹œ)

---

## 6. ë°ì´í„° í”Œë¡œìš°

### ì„¸ì…˜ ìƒì„± í”Œë¡œìš°
```
1. ì‚¬ìš©ì: ì‹œê°„ ì„ íƒ + ì‘ì—… ì„ íƒ(ì„ íƒ) + "ì‹œì‘" í´ë¦­
2. FocusTimer.handleStart()
3. POST /api/focus-sessions
   â†’ DBì— FocusSession ìƒì„± (duration, taskId)
4. sessionId ì €ì¥ + timerState='running'
5. 1ì´ˆë§ˆë‹¤ timeLeft ê°ì†Œ
```

### ì„¸ì…˜ ì™„ë£Œ í”Œë¡œìš°
```
1. timeLeft === 0
2. FocusTimer.handleComplete()
3. PATCH /api/focus-sessions/[id]
   â†’ actualTime=duration, completed=true
4. ë¸Œë¼ìš°ì € ì•Œë¦¼ ì „ì†¡
5. onSessionComplete() í˜¸ì¶œ
   â†’ focusHistoryKey ì¦ê°€
   â†’ FocusHistory ë¦¬ë Œë” + ì¬ì¡°íšŒ
6. íƒ€ì´ë¨¸ ë¦¬ì…‹
```

### ì„¸ì…˜ ì¤‘ë‹¨ í”Œë¡œìš°
```
1. ì‚¬ìš©ì: "ì¤‘ë‹¨" ë²„íŠ¼ í´ë¦­
2. FocusTimer.handleStop()
3. ê²½ê³¼ ì‹œê°„ ê³„ì‚° (elapsedRef + running ì‹œê°„)
4. PATCH /api/focus-sessions/[id]
   â†’ actualTime=(ê²½ê³¼ë¶„), interrupted=true
5. onSessionComplete() í˜¸ì¶œ
6. íƒ€ì´ë¨¸ ë¦¬ì…‹
```

---

## 7. í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

### íƒ€ì´ë¨¸ í…ŒìŠ¤íŠ¸
- [x] 25ë¶„ í”„ë¦¬ì…‹ ì„ íƒ â†’ ì‹œì‘ â†’ ì¹´ìš´íŠ¸ë‹¤ìš´ í™•ì¸
- [x] ì»¤ìŠ¤í…€ ì…ë ¥ (ì˜ˆ: 1ë¶„) â†’ ì‹œì‘ â†’ 1ë¶„ í›„ ìë™ ì™„ë£Œ
- [x] ì¼ì‹œì •ì§€ â†’ ì¬ê°œ â†’ ì¤‘ë‹¨ â†’ ì„¸ì…˜ ê¸°ë¡ í™•ì¸
- [x] ì‘ì—… ì—°ê²° â†’ ì™„ë£Œ â†’ íˆìŠ¤í† ë¦¬ì—ì„œ ì‘ì—…ëª… í‘œì‹œ í™•ì¸

### API í…ŒìŠ¤íŠ¸
- [x] POST /api/focus-sessions â†’ 201 Created
- [x] PATCH /api/focus-sessions/[id] â†’ 200 OK
- [x] GET /api/focus-sessions â†’ 200 OK + sessions ë°°ì—´

### í†µí•© í…ŒìŠ¤íŠ¸
- [x] ì„¸ì…˜ ì™„ë£Œ â†’ íˆìŠ¤í† ë¦¬ ìë™ ê°±ì‹ 
- [x] ì—¬ëŸ¬ ì„¸ì…˜ ìƒì„± â†’ í†µê³„ ê³„ì‚° ì •í™•ì„±
- [x] ë¸Œë¼ìš°ì € ì•Œë¦¼ ê¶Œí•œ â†’ ì™„ë£Œ ì‹œ ì•Œë¦¼ í‘œì‹œ

---

## 8. Phase 1 MVP ì™„ì„± ì²´í¬ë¦¬ìŠ¤íŠ¸

### A. ì¸ì¦ ì‹œìŠ¤í…œ âœ…
- [x] íšŒì›ê°€ì… (ì´ë©”ì¼, ì‚¬ìš©ìëª…, ë¹„ë°€ë²ˆí˜¸, ì´ë¦„)
- [x] ë¡œê·¸ì¸ (ì´ë©”ì¼ ë˜ëŠ” ì‚¬ìš©ìëª…)
- [x] ë¡œê·¸ì•„ì›ƒ
- [x] JWT í† í° + httpOnly ì¿ í‚¤
- [x] ì¸ì¦ ìƒíƒœ í™•ì¸ (AuthContext)

### B. ëª©í‘œ ê´€ë¦¬ âœ…
- [x] ëª©í‘œ ìƒì„±/ìˆ˜ì •/ì‚­ì œ
- [x] ì§„í–‰ë¥  ê³„ì‚° (Task 70% + Milestone 30%)
- [x] D-day í‘œì‹œ
- [x] ìƒ‰ìƒ ì„ íƒ (8ê°€ì§€ í”„ë¦¬ì…‹)
- [x] ëª©í‘œ ìƒíƒœ (active/completed/archived)

### C. ì‘ì—… ê´€ë¦¬ âœ…
- [x] ì‘ì—… ìƒì„±/ìˆ˜ì •/ì‚­ì œ
- [x] ì˜¤ëŠ˜ í•  ì¼ ëª©ë¡
- [x] ë‚ ì§œ ì—†ëŠ” ì‘ì—… í¬í•¨ (includeUnscheduled)
- [x] ìš°ì„ ìˆœìœ„ (high/mid/low)
- [x] ìƒíƒœ (todo/in_progress/completed)
- [x] ëª©í‘œ ì—°ê²° (optional)
- [x] ì™„ë£Œ í† ê¸€

### D. í¬ì»¤ìŠ¤ íƒ€ì´ë¨¸ âœ…
- [x] 25/50/90ë¶„ í”„ë¦¬ì…‹
- [x] ì»¤ìŠ¤í…€ ì‹œê°„ ì…ë ¥
- [x] ì‹œì‘/ì¼ì‹œì •ì§€/ì¬ê°œ/ì¤‘ë‹¨
- [x] ì‘ì—… ì—°ê²°
- [x] ì§„í–‰ë¥  í‘œì‹œ
- [x] ë¸Œë¼ìš°ì € ì•Œë¦¼
- [x] ì„¸ì…˜ ê¸°ë¡ (ì™„ë£Œ/ì¤‘ë‹¨ ëª¨ë‘)
- [x] í¬ì»¤ìŠ¤ íˆìŠ¤í† ë¦¬

---

## 9. ê¸°ìˆ  ìŠ¤íƒ ì •ë¦¬

### Frontend
- Next.js 15 (App Router)
- React 19
- TypeScript
- Tailwind CSS
- clsx + tailwind-merge

### Backend
- Next.js API Routes
- Prisma ORM
- PostgreSQL (Neon)

### ì¸ì¦
- bcrypt (SALT_ROUNDS=12)
- jsonwebtoken (JWT, 7ì¼ ë§Œë£Œ)
- httpOnly cookies (sameSite=strict)

### ìƒíƒœ ê´€ë¦¬
- React Context API (AuthContext)
- useState + useEffect

### ì•Œë¦¼
- Web Notifications API

---

## 10. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### User
- id (cuid), email (unique), username (unique), passwordHash, name

### Goal
- id, title, description, targetDate, status, color, order
- userId (FK â†’ User)

### Milestone
- id, title, targetDate, completed, completedAt, order
- goalId (FK â†’ Goal, cascade delete)

### Task
- id, title, description, scheduledDate, priority, status, order, completedAt
- userId (FK â†’ User)
- goalId (FK â†’ Goal, nullable, set null on delete)

### FocusSession
- id, duration, actualTime, completed, interrupted, createdAt
- userId (FK â†’ User)
- taskId (FK â†’ Task, nullable, set null on delete)

---

## 11. ë‹¤ìŒ ë‹¨ê³„ (Phase 2)

### Phase 2 ëª©í‘œ
- ìº˜ë¦°ë” ë·° (ì›”ê°„/ì£¼ê°„)
- ì¹¸ë°˜ ë³´ë“œ (Task ìƒíƒœë³„ ì»¬ëŸ¼)
- ë¸Œë¼ìš°ì € ì•Œë¦¼ í™•ì¥ (ì‘ì—… ì‹œì‘ ì‹œê°„ ë¦¬ë§ˆì¸ë”)
- í†µê³„ ëŒ€ì‹œë³´ë“œ ê¸°ë³¸

### Phase 3 ëª©í‘œ
- ë¦¬í¬íŠ¸ & ë¶„ì„
- ë£¨í‹´ ìë™í™”
- ë§ˆì¼ìŠ¤í†¤ ê´€ë¦¬

### Phase 4 ëª©í‘œ
- ì™¸ë¶€ í†µí•© (Google Calendar, Notion)
- íŒ€ í˜‘ì—… ê¸°ëŠ¥

---

## 12. ì¶”ê°€ ë²„ê·¸ ìˆ˜ì •

### 12.1 React Key ì¤‘ë³µ ì—ëŸ¬

#### ë¬¸ì œ
```
Encountered two children with the same key, `0`.
Keys should be unique so that components maintain their identity across updates.
```

#### ì›ì¸
- `GoalPanel`, `FocusHistory`, `TaskList` ëª¨ë‘ keyê°€ 0ë¶€í„° ì‹œì‘
- ê°™ì€ ë¶€ëª¨ ì»¨í…Œì´ë„ˆì—ì„œ `key={0}` ì¤‘ë³µ ë°œìƒ

#### í•´ê²°
```typescript
// Before
<GoalPanel key={goalKey} />
<FocusHistory key={focusHistoryKey} />
<TaskList key={taskKey} />

// After
<GoalPanel key={`goal-${goalKey}`} />
<FocusHistory key={`focus-${focusHistoryKey}`} />
<TaskList key={`task-${taskKey}`} />
```

**íŒŒì¼**: `app/dashboard/page.tsx:173,177,184`

---

### 12.2 FocusSession ìƒì„± ì‹¤íŒ¨ (500 ì—ëŸ¬)

#### ë¬¸ì œ
```
POST /api/focus-sessions 500 (Internal Server Error)
Create focus session error: Error [PrismaClientValidationError]
```

#### ì›ì¸ ë¶„ì„
1. Prisma ìŠ¤í‚¤ë§ˆì— `startedAt` í•„ë“œê°€ í•„ìˆ˜ì¸ë° APIì—ì„œ ì „ë‹¬í•˜ì§€ ì•ŠìŒ
2. `id` í•„ë“œì— `@default(cuid())` ì—†ì–´ì„œ ìˆ˜ë™ ìƒì„± í•„ìš”í–ˆìŒ

#### Prisma ìŠ¤í‚¤ë§ˆ ë¬¸ì œ
```prisma
// Before
model FocusSession {
  id          String    @id
  duration    Int
  actualTime  Int       @default(0)
  startedAt   DateTime  // í•„ìˆ˜ì¸ë° APIì—ì„œ ì „ë‹¬ ì•ˆ í•¨
  endedAt     DateTime?
  // ...
}
```

#### í•´ê²° ë°©ë²•

**1. Prisma ìŠ¤í‚¤ë§ˆ ìˆ˜ì •** (`prisma/schema.prisma:11`)
```prisma
model FocusSession {
  id          String    @id @default(cuid())  // ìë™ ìƒì„± ì¶”ê°€
  duration    Int
  actualTime  Int       @default(0)
  startedAt   DateTime
  endedAt     DateTime?
  completed   Boolean   @default(false)
  interrupted Boolean   @default(false)
  taskId      String?
  userId      String
  createdAt   DateTime  @default(now())
  Task        Task?     @relation(fields: [taskId], references: [id])
  User        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([taskId])
  @@index([userId, startedAt])
}
```

**2. API ìƒì„± ë¡œì§ ìˆ˜ì •** (`app/api/focus-sessions/route.ts:45`)
```typescript
// Before
const session = await prisma.focusSession.create({
  data: {
    duration,
    actualTime: 0,
    completed: false,
    interrupted: false,
    userId,
    taskId: taskId || null,
  },
});

// After
const session = await prisma.focusSession.create({
  data: {
    duration,
    actualTime: 0,
    startedAt: new Date(),  // ì¶”ê°€
    completed: false,
    interrupted: false,
    userId,
    taskId: taskId || null,
  },
});
```

**3. API ì—…ë°ì´íŠ¸ ë¡œì§ ìˆ˜ì •** (`app/api/focus-sessions/[id]/route.ts:39`)
```typescript
// ì„¸ì…˜ ì¢…ë£Œ ì‹œ endedAt ì„¤ì •
const shouldEnd = completed === true || interrupted === true;

const updatedSession = await prisma.focusSession.update({
  where: { id },
  data: {
    actualTime: actualTime !== undefined ? actualTime : existingSession.actualTime,
    completed: completed !== undefined ? completed : existingSession.completed,
    interrupted: interrupted !== undefined ? interrupted : existingSession.interrupted,
    endedAt: shouldEnd ? new Date() : existingSession.endedAt,  // ì¶”ê°€
  },
  // ...
});
```

**4. Prisma í´ë¼ì´ì–¸íŠ¸ ì¬ìƒì„±**
```bash
npx prisma generate
npx prisma db push
```

#### ê²°ê³¼
âœ… íƒ€ì´ë¨¸ ì‹œì‘ ì‹œ FocusSession ì •ìƒ ìƒì„±
âœ… ì„¸ì…˜ ì™„ë£Œ/ì¤‘ë‹¨ ì‹œ endedAt ìë™ ê¸°ë¡

---

## 13. ì•Œë ¤ì§„ ì´ìŠˆ

### í•´ê²°ë¨
- âœ… ì‘ì—… ëª©ë¡ í‘œì‹œ ì•ˆ ë¨ (íƒ€ì„ì¡´ ë²„ê·¸)
- âœ… React key ì¤‘ë³µ ê²½ê³ 
- âœ… FocusSession ìƒì„± ì‹¤íŒ¨ (Prisma validation ì—ëŸ¬)

### ì£¼ì˜ì‚¬í•­
- Next.js dev server ì¬ì‹œì‘ ì‹œ API ë¼ìš°íŠ¸ ì¬ì»´íŒŒì¼ í•„ìš” (íŒŒì¼ ìˆ˜ì • ë˜ëŠ” touch)
- Prisma ì—°ê²° í’€ë§: ê°œë°œ í™˜ê²½ì—ì„œ ê°€ë” `Error: { kind: Closed }`

---

## 14. ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡

### ìƒˆë¡œ ìƒì„±ëœ íŒŒì¼
1. `components/dashboard/FocusTimer.tsx` - í¬ì»¤ìŠ¤ íƒ€ì´ë¨¸ UI (355ì¤„)
2. `components/dashboard/FocusHistory.tsx` - í¬ì»¤ìŠ¤ íˆìŠ¤í† ë¦¬ (154ì¤„)
3. `app/api/focus-sessions/route.ts` - FocusSession API (ìƒì„±, ëª©ë¡)
4. `app/api/focus-sessions/[id]/route.ts` - FocusSession API (ì—…ë°ì´íŠ¸, ì‚­ì œ)
5. `docs/2025-01-13_ì‘ì—…_ì¼ì§€.md` - ì‘ì—… ì¼ì§€

### ìˆ˜ì •ëœ íŒŒì¼
1. `app/api/tasks/today/route.ts:21-30` - ë‚ ì§œ ë²”ìœ„ ë¡œì§ ìˆ˜ì •
2. `app/dashboard/page.tsx:10,53-81,171-178,183-194` - íƒ€ì´ë¨¸/íˆìŠ¤í† ë¦¬ í†µí•©
3. `prisma/schema.prisma:11` - FocusSession ìŠ¤í‚¤ë§ˆ (id default ì¶”ê°€)

---

## 15. ì»¤ë°‹ ë©”ì‹œì§€ (ê¶Œì¥)

```bash
feat: implement focus timer with session tracking and fix bugs

- Add FocusTimer component with presets (25/50/90min) and custom input
- Add FocusSession API endpoints (create, update, list, delete)
- Add FocusHistory component with statistics
- Implement browser notifications for session completion
- Track interrupted sessions in database
- Fix task list date range bug (timezone issue)
- Fix React key duplication warning
- Fix FocusSession creation error (add startedAt, endedAt fields)
- Add default cuid() for FocusSession id
- Integrate timer and history into dashboard

ğŸ¤– Generated with Claude Code
Co-Authored-By: Claude <noreply@anthropic.com>
```

---

## 16. ì‘ì—… ì‹œê°„
- ì‘ì—… ëª©ë¡ ë²„ê·¸ ìˆ˜ì •: ~30ë¶„
- í¬ì»¤ìŠ¤ íƒ€ì´ë¨¸ êµ¬í˜„: ~2ì‹œê°„
- í†µí•© ë° í…ŒìŠ¤íŠ¸: ~30ë¶„
- React key ì¤‘ë³µ ì—ëŸ¬ ìˆ˜ì •: ~5ë¶„
- FocusSession API ì—ëŸ¬ ìˆ˜ì •: ~20ë¶„

**ì´ ì‘ì—… ì‹œê°„: ì•½ 3ì‹œê°„ 25ë¶„**

---

## 17. ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1 MVP ì™„ì„± âœ…
- [x] ì¸ì¦ ì‹œìŠ¤í…œ (íšŒì›ê°€ì…, ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒ)
- [x] ëª©í‘œ ê´€ë¦¬ (ìƒì„±, ìˆ˜ì •, ì‚­ì œ, ì§„í–‰ë¥ )
- [x] ì‘ì—… ê´€ë¦¬ (ìƒì„±, ìˆ˜ì •, ì‚­ì œ, ì™„ë£Œ)
- [x] í¬ì»¤ìŠ¤ íƒ€ì´ë¨¸ (í”„ë¦¬ì…‹, ì»¤ìŠ¤í…€, ì„¸ì…˜ ê¸°ë¡)
- [x] í¬ì»¤ìŠ¤ íˆìŠ¤í† ë¦¬ (í†µê³„, ëª©ë¡)
- [x] ë¸Œë¼ìš°ì € ì•Œë¦¼

### ë²„ê·¸ ìˆ˜ì • ì™„ë£Œ âœ…
- [x] ì‘ì—… ëª©ë¡ í‘œì‹œ ì•ˆ ë¨ (íƒ€ì„ì¡´)
- [x] React key ì¤‘ë³µ ê²½ê³ 
- [x] FocusSession ìƒì„± ì‹¤íŒ¨

### í…ŒìŠ¤íŠ¸ ì™„ë£Œ âœ…
- [x] íƒ€ì´ë¨¸ ì‹œì‘ â†’ ì„¸ì…˜ ìƒì„±
- [x] íƒ€ì´ë¨¸ ì¼ì‹œì •ì§€/ì¬ê°œ
- [x] íƒ€ì´ë¨¸ ì¤‘ë‹¨ â†’ interrupted ê¸°ë¡
- [x] íƒ€ì´ë¨¸ ì™„ë£Œ â†’ completed ê¸°ë¡ + ì•Œë¦¼
- [x] íˆìŠ¤í† ë¦¬ ìë™ ê°±ì‹ 
- [x] ì‘ì—… ì—°ê²° ê¸°ëŠ¥

---

## 18. ë‹¤ìŒ ì„¸ì…˜ ì‹œì‘ ì „ ì²´í¬ì‚¬í•­

1. **í™˜ê²½ í™•ì¸**
   ```bash
   # Dev server ì‹¤í–‰ í™•ì¸
   npm run dev

   # Prisma Studio (ì„ íƒ)
   npx prisma studio
   ```

2. **í…ŒìŠ¤íŠ¸**
   - ë¸Œë¼ìš°ì €: http://localhost:3000
   - ë¡œê·¸ì¸ â†’ ëŒ€ì‹œë³´ë“œ
   - ì‘ì—… ìƒì„± â†’ íƒ€ì´ë¨¸ ì‹œì‘ â†’ ì™„ë£Œ/ì¤‘ë‹¨
   - íˆìŠ¤í† ë¦¬ í™•ì¸

3. **Phase 2 ì¤€ë¹„**
   - ìº˜ë¦°ë” ë·° ì„¤ê³„
   - ì¹¸ë°˜ ë³´ë“œ UI ëª©ì—…
   - í†µê³„ ëŒ€ì‹œë³´ë“œ ìš”êµ¬ì‚¬í•­ ì •ë¦¬
