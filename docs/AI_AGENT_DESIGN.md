# AI Agent 설계 문서

> 버전: 0.1.0 (Phase 1 설계)
> 최종 업데이트: 2026-02-07

---

## 1. 비전

### 궁극적 목표

**"모든 것을 대신 결정해주고 결재해주는 개인 맞춤형 AI 비서"**

현재 앱은 **도구(Tool)**이지만, 궁극적으로는 **에이전트(Agent)**로 진화한다.

| 현재 | 목표 |
|------|------|
| 사용자가 계획하고 실행 | AI가 계획하고 사용자가 승인 |
| 수동 입력 | 자동 수집 + 제안 |
| "뭐 해야 하지?" 질문 | 질문 자체가 사라짐 |

### 참조 모델

**아이언맨의 자비스(JARVIS)**
- 목표를 대신 정하지 않음
- 지금 이 순간의 충돌은 즉시 정리
- 항상 이유를 설명: "Sir, 제안드립니다만..."

---

## 2. AI 비서 아키텍처

```
┌─────────────────────────────────────────────────────────┐
│                    🧠 AI 비서 코어                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐ │
│  │ CAPTURE │ → │ DECIDE  │ → │ EXECUTE │ → │  LEARN  │ │
│  │  수집   │   │  결정   │   │  실행   │   │  학습   │ │
│  └─────────┘   └─────────┘   └─────────┘   └─────────┘ │
│       ↑                                         │       │
│       └─────────────────────────────────────────┘       │
│                      피드백 루프                         │
└─────────────────────────────────────────────────────────┘
```

### 계층별 역할

| 계층 | 역할 | Phase 1 범위 |
|------|------|-------------|
| **CAPTURE** | 모든 입력 수집 (인박스, 외부 연동) | 현재 Task + 자연어 입력 |
| **DECIDE** | 판단 기준 생성 + 결정 제안 | ✅ 핵심 구현 대상 |
| **EXECUTE** | 결정 실행 (일정 등록, 알림 등) | 기존 기능 활용 |
| **LEARN** | 사용자 피드백 학습 | 수정 로그 기록 |

---

## 3. 최적화 목적

### 핵심 정의 (ZERO Point)

> **"이 AI 비서는 단기 마감과 장기 목표를 동시에 망치지 않는 선택을 최적화한다."**

### 해석

| 옵션 | 포함 여부 |
|------|----------|
| A. 마감 준수 | ✅ 포함 |
| B. 장기 목표 진척 | ✅ 포함 |
| C. 스트레스 최소화 | ⚠️ 제약 조건으로 흡수 |
| D. 성과 최대화 | ⚠️ 결과로 따라옴 (목적 아님) |

### 운영 원칙

1. 마감이 임박한 일은 무시하지 않는다
2. 그러나 장기 목표를 지속적으로 잠식하는 선택은 피한다
3. 오늘의 무리는 내일의 붕괴로 이어지면 감점
4. 사용자가 "이건 잘못 선택했다"고 말할 가능성을 최소화

→ **후회 확률 최소화 모델**

---

## 4. Phase 1 정의

### 목표

> **"AI가 결정을 내리는 것이 아니라, 판단 이유를 말할 수 있게 만드는 단계"**

### 첫 번째 기능

| 항목 | 결정 |
|------|------|
| **기능** | 작업 A vs B 중 뭘 먼저? (실시간 우선순위 제안) |
| **강도** | 1️⃣ 제안만 + 이유 설명 |
| **목적** | 실시간 판단 기준 학습 + 신뢰 형성 |

### 왜 이 기능인가

- 자비스가 가장 자주 개입하는 순간: "둘 다 해야 하는데 뭐부터?"
- 전술 + 즉시성 + 반복 빈도가 가장 높음
- 결정 자동화가 아닌 **신뢰 형성**이 목적

### 예시 출력

```
"지금은 [Task B]를 먼저 추천합니다.

이유:
1. A는 D+5, B는 오늘 마감 (긴급도)
2. B 완료 시 [Goal X] 다음 단계 가능 (장기 연결)
3. 현재 오후 2시 - 집중도 높은 시간대 (시간 적합)"
```

### 사용자 수정 시

```
사용자가 A를 먼저로 변경

→ 기록: "사용자가 A 우선 선택"
→ 선택적: "어떤 이유로 A를 선택하셨나요?" (학습용)
```

---

## 5. DECIDE-0: 판단 기준 모델

### 개요

DECIDE는 두 계층으로 분리:

| 계층 | 역할 | 특성 |
|------|------|------|
| **DECIDE-0** | 판단 근거 생성 | 보이지 않는 계층 |
| **DECIDE-1** | 결정 제안 | 사용자에게 노출 |

### DECIDE-0 입력 데이터

| 데이터 | 현재 상태 | 출처 |
|--------|----------|------|
| 마감일 | ✅ 있음 | `Task.scheduledDate` |
| 우선순위 | ✅ 있음 | `Task.priority` |
| 장기 목표 연결 | ✅ 있음 | `Task → Goal → LifeGoal` |
| 목표 기여도 | ✅ 있음 | `Task.weight` |
| 시간대별 집중 패턴 | ✅ 있음 | `FocusSession` |
| 예상 소요 시간 | ❌ 없음 | **추가 필요** |
| 작업 의존성 | ❌ 없음 | **추가 필요** |
| 사용자 선호 기록 | ❌ 없음 | **추가 필요** |

---

## 6. 판단 규칙 세트

### 규칙 1: 마감 긴급도 (Deadline Urgency)

```
D-day 계산 기준:

┌────────────────┬──────────┬─────────────────────┐
│     범위       │   등급   │        행동         │
├────────────────┼──────────┼─────────────────────┤
│ D+0 (오늘)     │ 🔴 긴급  │ Override 가능       │
│ D+1 (내일)     │ 🔴 긴급  │ Override 가능       │
│ D+2 ~ D+3      │ 🟡 임박  │ 주의 필요           │
│ D+4 이상       │ 🟢 여유  │ 장기 목표 우선 가능 │
│ 마감 없음      │ ⚪ 중립  │ 다른 규칙 우선      │
└────────────────┴──────────┴─────────────────────┘

충돌 규칙:
- 🔴 vs 🟢 → 🔴 우선 (단, 장기 목표 손상 체크)
- 🔴 vs 🔴 → 다음 규칙으로 이동
```

### 규칙 2: 장기 목표 연결도 (Long-term Impact)

```
연결 구조:
Task → Goal → LifeGoal

점수 체계:
┌─────────────────────────────┬───────┬─────────────┐
│           연결 상태          │ 점수  │    의미     │
├─────────────────────────────┼───────┼─────────────┤
│ LifeGoal 연결 + weight 높음 │ ⭐⭐⭐ │ 장기 중요   │
│ Goal 연결됨                  │ ⭐⭐   │ 중기 중요   │
│ 연결 없음 (단독 Task)        │ ⭐     │ 단기 작업   │
└─────────────────────────────┴───────┴─────────────┘

적용 규칙:
- 마감 여유 있을 때: ⭐⭐⭐ 우선
- 마감 긴급할 때: 긴급 먼저 처리
  - 단, ⭐⭐⭐ 작업이 3일 이상 미뤄지면 경고
```

### 규칙 3: 우선순위 가중치 (Priority Weight)

```
priority 필드 가중치:
┌──────────┬────────┐
│ priority │ 가중치 │
├──────────┼────────┤
│ high     │ 1.5x   │
│ mid      │ 1.0x   │
│ low      │ 0.7x   │
└──────────┴────────┘

weight 필드 (1-100):
- 목표 기여도로 활용
- 기본값: 1

최종 점수 = priority_weight × task_weight
```

### 규칙 4: 시간대 적합성 (Time Fitness)

```
FocusSession 데이터 기반 계산:

1. 사용자의 시간대별 집중 성공률 계산
   - 시간대: 0~5, 6~9, 9~12, 12~14, 14~18, 18~21, 21~24
   - 성공률 = 완료 세션 / 전체 세션

2. 현재 시간대 성공률에 따른 추천:
   ┌─────────────┬──────────────────────┐
   │  성공률     │        추천          │
   ├─────────────┼──────────────────────┤
   │ 70% 이상    │ 어려운/중요한 작업   │
   │ 40~70%      │ 일반 작업            │
   │ 40% 미만    │ 가벼운 작업          │
   └─────────────┴──────────────────────┘
```

### 규칙 5: 충돌 해결 (Conflict Resolution)

```
마감 긴급 vs 장기 목표 충돌 시:

Case 1: 긴급 작업이 짧음 (estimatedMinutes < 30)
  → 긴급 먼저
  → 이유: "빠르게 끝내고 장기 목표로"

Case 2: 긴급 작업이 길고, 장기 목표도 오늘 안 하면 위험
  → 장기 목표 일부 먼저 (30분)
  → 이유: "최소 30분 투자 후 긴급으로"

Case 3: 둘 다 긴급 (D+0 또는 D+1)
  → weight 높은 것 우선
  → 이유: "목표 기여도 기준"
```

---

## 7. 판단 흐름 (Decision Flow)

```
┌─────────────────────────────────────────────┐
│              입력: Task A, Task B            │
└─────────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────┐
│     Step 1: 마감 긴급도 비교                 │
│     ─────────────────────────────           │
│     - 하나만 긴급? → 긴급 우선 (→ Step 2 체크) │
│     - 둘 다 긴급 또는 여유? → Step 2로       │
└─────────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────┐
│     Step 2: 장기 목표 연결도 비교            │
│     ─────────────────────────────           │
│     - 차이 큼? → 장기 연결된 것 우선         │
│     - 차이 작음? → Step 3로                  │
└─────────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────┐
│     Step 3: 우선순위 × 기여도 점수 비교      │
│     ─────────────────────────────           │
│     - 점수 = priority_weight × task_weight  │
│     - 높은 점수 우선                         │
└─────────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────┐
│     Step 4: 시간대 적합성 보정               │
│     ─────────────────────────────           │
│     - 현재 집중도 좋음? → 어려운 것 추천     │
│     - 현재 집중도 낮음? → 가벼운 것 추천     │
└─────────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────┐
│              출력: 추천 + 이유               │
└─────────────────────────────────────────────┘
```

---

## 8. 데이터 스키마 확장

### 현재 Task 모델

```prisma
model Task {
  id               String    @id @default(cuid())
  title            String
  description      String?
  scheduledDate    DateTime?
  scheduledTime    String?
  scheduledEndTime String?
  priority         String    @default("mid")
  status           String    @default("todo")
  weight           Int       @default(1)
  // ... 기타 필드
}
```

### 추가 필요 필드

```prisma
model Task {
  // 기존 필드...

  // Phase 1 추가
  estimatedMinutes  Int?      // 예상 소요 시간 (분)

  // Phase 2 추가 (선택적)
  deadlineType      String?   // "hard" | "soft" | null
  blockedByTaskId   String?   // 의존성: 이 작업이 끝나야 시작 가능
}
```

### 새로운 모델: AI 결정 로그

```prisma
model AIDecisionLog {
  id              String   @id @default(cuid())

  // 입력
  taskAId         String   // 비교 대상 A
  taskBId         String   // 비교 대상 B

  // 출력
  recommendedId   String   // AI 추천 작업 ID
  reasons         String   // JSON: 이유 배열
  confidence      Float    // 신뢰도 (0.0 ~ 1.0)

  // 사용자 반응
  userChoice      String?  // 사용자가 실제 선택한 작업 ID
  userOverride    Boolean  @default(false) // AI 추천 거부 여부
  userFeedback    String?  // 사용자 피드백 (선택적)

  // 메타
  userId          String
  createdAt       DateTime @default(now())

  @@index([userId, createdAt])
}
```

### 새로운 모델: 사용자 선호도

```prisma
model UserPreference {
  id        String   @id @default(cuid())
  userId    String   @unique

  // 시간대 선호
  preferredWorkHours    String?  // JSON: {"start": "09:00", "end": "18:00"}
  preferredFocusHours   String?  // JSON: ["09:00-12:00", "14:00-17:00"]

  // 작업 선호
  preferMorningForHard  Boolean  @default(true)  // 어려운 작업은 오전에
  maxDailyFocusMinutes  Int?     // 하루 최대 집중 시간

  // 학습된 패턴 (자동 업데이트)
  learnedPatterns       String?  // JSON: AI가 학습한 패턴

  updatedAt DateTime @updatedAt
}
```

---

## 9. API 설계

### 엔드포인트

```
POST /api/ai/recommend-next
```

### 요청

```typescript
interface RecommendNextRequest {
  taskIds: string[];      // 비교할 작업 ID 목록 (최소 2개)
  context?: {
    currentTime?: string; // ISO 8601
    energyLevel?: 'high' | 'medium' | 'low';
  };
}
```

### 응답

```typescript
interface RecommendNextResponse {
  recommended: {
    taskId: string;
    task: Task;
  };
  reasons: Array<{
    type: 'deadline' | 'longterm' | 'priority' | 'time_fitness';
    description: string;
    weight: number;  // 이 이유가 결정에 기여한 정도
  }>;
  alternatives: Array<{
    taskId: string;
    task: Task;
    whyNot: string;  // 왜 이게 2순위인지
  }>;
  confidence: number;  // 0.0 ~ 1.0
  decisionLogId: string;  // 로그 ID (피드백용)
}
```

### 피드백 엔드포인트

```
POST /api/ai/decision-feedback
```

```typescript
interface DecisionFeedbackRequest {
  decisionLogId: string;
  userChoice: string;      // 사용자가 실제 선택한 작업 ID
  feedback?: string;       // 선택 이유 (선택적)
}
```

---

## 10. UI/UX 설계

### 진입점

**Option A: 대시보드 위젯**
```
┌─────────────────────────────────────┐
│  🤖 다음 작업 추천                   │
├─────────────────────────────────────┤
│  📌 "기획서 작성"을 먼저 추천합니다   │
│                                     │
│  이유:                              │
│  • 오늘 마감 (D+0)                  │
│  • [프로젝트 X] 진행에 필수          │
│                                     │
│  [시작하기]  [다른 작업 선택]        │
└─────────────────────────────────────┘
```

**Option B: 플로팅 버튼**
```
             ┌─────┐
             │ 🤖  │  ← "뭐 먼저 할까요?" 버튼
             └─────┘
```

**Option C: 작업 목록 상단**
```
오늘 할 일
─────────────────────────────
🤖 추천: "기획서 작성" 먼저
   이유: 오늘 마감, 프로젝트 X 필수
─────────────────────────────
☐ 기획서 작성      [D+0] ⭐
☐ 이메일 답장      [D+2]
☐ 미팅 준비        [D+1]
```

### 이유 설명 템플릿

```
추천 메시지 패턴:

1. 마감 기반
   "오늘/내일 마감이라 먼저 처리 권장"

2. 장기 목표 기반
   "[LifeGoal명] 달성을 위한 핵심 작업"
   "[Goal명]의 다음 단계 진행에 필요"

3. 시간대 기반
   "현재 시간대 집중도가 높아 어려운 작업 추천"
   "가벼운 작업으로 워밍업 후 집중 작업 권장"

4. 복합
   "오늘 마감 + [Goal명] 진행에 필수"
```

### 사용자 Override 시

```
┌─────────────────────────────────────┐
│  다른 작업을 선택하셨네요.           │
│                                     │
│  "이메일 답장"을 먼저 하시는 이유가  │
│  있으신가요? (선택)                  │
│                                     │
│  ○ 급한 요청이 왔어요               │
│  ○ 지금 컨디션에 맞아요             │
│  ○ 기분이 그래요                    │
│  ○ 기타: [          ]              │
│                                     │
│  [건너뛰기]  [저장]                  │
└─────────────────────────────────────┘
```

---

## 11. 구현 로드맵

### Phase 1: 기반 구축 (현재)

| 단계 | 작업 | 상태 |
|------|------|------|
| 1.1 | 스키마 확장 (estimatedMinutes, AIDecisionLog) | ⬜ |
| 1.2 | DECIDE-0 판단 로직 구현 | ⬜ |
| 1.3 | API 엔드포인트 구현 | ⬜ |
| 1.4 | 대시보드 위젯 UI | ⬜ |
| 1.5 | 피드백 수집 로직 | ⬜ |

### Phase 2: 학습 강화

| 단계 | 작업 | 상태 |
|------|------|------|
| 2.1 | UserPreference 모델 구현 | ⬜ |
| 2.2 | 사용자 패턴 분석 로직 | ⬜ |
| 2.3 | 피드백 기반 규칙 조정 | ⬜ |

### Phase 3: 확장

| 단계 | 작업 | 상태 |
|------|------|------|
| 3.1 | 아침 오늘 할 일 자동 제안 | ⬜ |
| 3.2 | 주간 회고 자동 생성 | ⬜ |
| 3.3 | 목표 진행 예측 | ⬜ |

---

## 12. 성공 지표

### Phase 1 KPI

| 지표 | 목표 | 측정 방법 |
|------|------|----------|
| 추천 수락률 | > 60% | userOverride = false 비율 |
| 일일 사용률 | > 3회/일 | API 호출 수 |
| 이유 만족도 | > 70% | 피드백 "도움됨" 비율 |

### 신뢰 형성 지표

- 첫 주: 추천 이유 읽는 비율
- 둘째 주: Override 감소율
- 셋째 주: 자발적 피드백 증가율

---

## 13. 리스크 및 완화

| 리스크 | 완화 방안 |
|--------|----------|
| 잘못된 추천 반복 | 피드백 즉시 반영, 패턴 학습 |
| 사용자 무시 | 추천 빈도 조절, 방해 최소화 |
| 데이터 부족 | 냉정 시작 규칙, 점진적 학습 |
| 과도한 자동화 | Phase 1은 제안만, 승인 필수 |

---

## 14. 참고: 설계 원칙

### ZERO가 정의한 핵심

> "이 비서의 본질은 '실행'이 아니라 '사용자의 의사결정 부담을 대신 지는 것'"

### 신뢰 형성 우선

- 결정 자동화보다 **이유 설명** 먼저
- "왜 이렇게 했지?" 질문이 나오면 실패
- 자비스 초기: "Sir, 제안드립니다만..."

### 점진적 권한 확대

```
Phase 1: 제안 (이유 포함)
Phase 2: 제안 + 자동 실행 옵션
Phase 3: 자동 실행 (중요한 것만 승인)
Phase 4: 완전 자율 (예외만 보고)
```

---

**문서 작성: Claude + ChatGPT(ZERO) 협업**
**검토: 사용자**
**다음 단계: Phase 1.1 스키마 확장**
